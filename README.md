## Общие сведения
Задание написано с использованием PHP 8.1 и Laravel версии 8.  
Типы данных полей БД определял, глядя на данные которые возвращает АПИ.  
Также поля, которые могут содержать null, определил основываясь только на полученных данных.

## Доступы к БД и названия таблиц
DB_HOST=FVH2.spaceweb.ru  
DB_PORT=<b>3308</b>  
DB_DATABASE=kulyaginvy  
DB_USERNAME=kulyaginvy  
DB_PASSWORD=VxiDSBSSXHaFN1  

Используются следующие таблицы для хранения данных:
<ul>
<li><b>sales</b> - таблица с продажами</li>
<li><b>orders</b> - таблица с заказами</li>
<li><b>stocks</b> - таблица со складами </li>
<li><b>incomes</b> - таблица с доходами</li>
</ul>

## Установка

Для установки нужно склонировать репозиторий себе на компьютер.

Скопировать файл .env.example в .env  
В .env файле необходимо указать параметры подключения к базе данных (подключение - mysql, хост, порт, название БД, имя пользователя и пароль).  
А затем выполнить следующие команды:

<b>composer install</b>  
<b>php artisan key:generate</b>  
<b>php artisan migrate</b>

## Необходимые env-переменные

В файле .env также нужно указать следующие параметры: 

<b>API_BASE_URI</b> - хост, где находится API, которое будет возвращать данные, в формате http://<хост>:<порт> без слэша на конце.

<b>API_KEY</b> - ключ для авторизации.

## Запуск
Запуск загрузки данных в базу производится выполнением консольной команды  
<b>php artisan data:load</b>  
Так как на момент написания задания неизвестно, какие поля могут являться первичным ключом таблицы, какие поля должны быть уникальными, при запуске скрипта происходит очистка четырёх таблиц БД.  
Скрипт пытается загрузить данные, начиная с первого января 1970. Исключением является эндпойнт /api/stocks, при обращении к которому получаем данные только за сегодняшний день.

Примерное время выполнения консольной команды <b>php artisan data:load</b> при загрузке всего набора данных составляет примерно 10 минут. Объём базы после загрузки - 70 МБ.


## Основной загрузчик
Родительский абстрактный класс для загрузки всех четырёх типов данных находится в файле <i>app/Classes/BaseLoader.php</i>, который имеет абстрактных метод load.  
Этот метод load переопределяется в дочерних классах <i>SalesLoader, OrdersLoader, StocksLoader, IncomesLoader</i> и отвечает, непосредственно, за вставку данных в таблицы. 
Передача данных для вставки в БД происходит по ссылке, чтобы исключить копирование в памяти больших объёмов данных.   
Обращение к АПИ, и постраничное получение данных, осуществляется в методе execute класса BaseLoader.  
Так как достоверно не известно, какие поля в БД должны быть уникальными, какие являются первичными ключами, при запуске консольной команды происходит отчистка таблиц базы данных.  
Метод getAdditionalQueryParams класса BaseLoader переопределяется только в классе StockLoader, так как там нужен только один параметр - dateFrom, с датой равной сегдняшней дате.

